<div class="cliente-list-page">
  <div class="page-header">
    <div>
      <h1 class="text-up-04 text-weight-bold mb-1">Clientes</h1>
      <p class="text-base text-muted">Gerencie clientes e endereços.</p>
    </div>
    <div class="header-actions">
      <br-button type="button" emphasis="secondary" density="small" (click)="loadClientes()">
        <i class="fas fa-rotate-right mr-2"></i>Recarregar
      </br-button>
      <br-button type="button" emphasis="primary" density="small" (click)="goToNew()">
        <i class="fas fa-plus mr-2"></i>Novo cliente
      </br-button>
    </div>
  </div>

  <div class="messages" *ngIf="error() || feedback()">
    <br-message
      *ngIf="error()"
      state="danger"
      [message]="error()"
      [isClosable]="true"
      [showIcon]="true"
      (brDidClose)="error.set(null)">
    </br-message>
    <br-message
      *ngIf="feedback()"
      state="success"
      [message]="feedback()"
      [isClosable]="true"
      [showIcon]="true"
      (brDidClose)="feedback.set(null)">
    </br-message>
  </div>

  <br-card>
    <div slot="header" class="card-header-content">
      <span>Lista de clientes</span>
    </div>

    <div class="card-body" slot="content">
      <div class="filters">
        <div class="filter-item search">
          <br-input
            label="Buscar"
            placeholder="Nome, documento ou telefone"
            type="search"
            (valueChange)="onSearchChange($event)">
          </br-input>
        </div>
      </div>

      <div class="loading-container" *ngIf="loading()">
        <br-loading label="Carregando clientes..."></br-loading>
      </div>

      <div class="table-container" *ngIf="!loading()">
        <br-table *ngIf="paginated().length > 0">
          <br-table-header-row [attr.slot]="'header'">
            <br-table-header-cell>Nome</br-table-header-cell>
            <br-table-header-cell>Documento</br-table-header-cell>
            <br-table-header-cell>Telefone</br-table-header-cell>
            <br-table-header-cell>Endereço</br-table-header-cell>
            <br-table-header-cell horizontalAlign="center">Ações</br-table-header-cell>
          </br-table-header-row>

          <br-table-row
            [attr.slot]="'row'"
            *ngFor="let cli of paginated(); trackBy: trackByCliente">
            <br-table-cell>
              <div class="nome">
                <div class="title">{{ cli.nome }}</div>
              </div>
            </br-table-cell>
            <br-table-cell>
              <span class="text-muted">{{ formatDoc(cli.documento) }}</span>
            </br-table-cell>
            <br-table-cell>
              <span class="text-muted">{{ formatTel(cli.tel_1) }}</span>
            </br-table-cell>
            <br-table-cell>
              <span class="text-muted">{{ firstCity(cli) }}</span>
            </br-table-cell>
            <br-table-cell horizontalAlign="center">
              <div class="actions">
                <br-button type="button" emphasis="tertiary" density="small" (click)="goToEdit(cli.id)">
                  <i class="fas fa-pen"></i>
                </br-button>
                <br-button type="button" emphasis="tertiary" density="small" (click)="confirmarExcluir(cli)">
                  <i class="fas fa-trash"></i>
                </br-button>
              </div>
            </br-table-cell>
          </br-table-row>
        </br-table>

        <div class="empty-state" *ngIf="paginated().length === 0">
          <i class="fas fa-users-slash"></i>
          <p>Nenhum cliente encontrado</p>
        </div>
      </div>

      <div class="pagination-container" *ngIf="!loading() && totalItems() > 0">
        <br-pagination
          [total]="totalPages()"
          [current]="currentPage()"
          [totalItems]="totalItems()"
          [perPage]="perPage()"
          [perPageOptions]="[5, 10, 25, 50]"
          variant="contextual"
          itemsText="clientes"
          perPageLabel="Itens por página"
          goToPageLabel="Ir para página"
          (pageChange)="onPageChange($event)"
          (perPageChange)="onPerPageChange($event)">
        </br-pagination>
      </div>
    </div>
  </br-card>
</div>
