<div class="categoria-list-page">
  <div class="page-header">
    <div>
      <h1 class="text-up-04 text-weight-bold mb-1">Categorias</h1>
      <p class="text-base text-muted">Gerencie categorias de produtos e suas opcoes.</p>
    </div>
    <div class="header-actions">
      <br-button type="button" emphasis="secondary" density="small" (click)="loadCategorias()">
        <i class="fas fa-sync mr-2"></i>Recarregar
      </br-button>
      <br-button type="button" emphasis="primary" density="small" (click)="goToNew()">
        <i class="fas fa-plus mr-2"></i>Nova categoria
      </br-button>
    </div>
  </div>

  <div class="messages" *ngIf="error() || feedback()">
    <br-message
      *ngIf="error()"
      state="danger"
      [message]="error()"
      [isClosable]="true"
      [showIcon]="true"
      (brDidClose)="dismissError()">
    </br-message>
    <br-message
      *ngIf="feedback()"
      state="success"
      [message]="feedback()"
      [isClosable]="true"
      [showIcon]="true"
      (brDidClose)="dismissFeedback()">
    </br-message>
  </div>

  <br-card>
    <div slot="header" class="card-header-content">
      <span>Lista de categorias</span>
    </div>

    <div class="card-body" slot="content">
      <div class="filters">
        <div class="filter-item">
          <br-select
            label="Culinaria"
            placeholder="Todas"
            [options]="filterOptions()"
            [value]="selectedCulinaria()"
            (valueChange)="onFilterChange($event)">
          </br-select>
        </div>

        <div class="filter-item search">
          <br-input
            label="Buscar"
            placeholder="Nome, descricao ou culinaria"
            type="search"
            (valueChange)="onSearchChange($event)">
          </br-input>
        </div>
      </div>

      <div class="loading-container" *ngIf="loading()">
        <br-loading label="Carregando categorias..."></br-loading>
      </div>

      <div class="table-container" *ngIf="!loading()">
        <br-table *ngIf="paginatedCategorias().length > 0">
          <br-table-header-row [attr.slot]="'header'">
            <br-table-header-cell>Nome</br-table-header-cell>
            <br-table-header-cell>Culinaria</br-table-header-cell>
            <br-table-header-cell>Opcoes</br-table-header-cell>
            <br-table-header-cell>Disponibilidade</br-table-header-cell>
            <br-table-header-cell>Horario</br-table-header-cell>
            <br-table-header-cell>Status</br-table-header-cell>
            <br-table-header-cell horizontalAlign="center">Acoes</br-table-header-cell>
          </br-table-header-row>

          <br-table-row
            [attr.slot]="'row'"
            *ngFor="let cat of paginatedCategorias(); trackBy: trackByCat">
            <br-table-cell>
              <div class="nome">
                <div class="title">{{ cat.nome }}</div>
                <div class="subtitle" *ngIf="cat.descricao">{{ cat.descricao }}</div>
              </div>
            </br-table-cell>

            <br-table-cell>
              <br-tag
                shape="rounded"
                density="small"
                [label]="culinariaNome(cat.id_culinaria)"
                bgColor="blue-warm-vivid-60">
              </br-tag>
            </br-table-cell>

            <br-table-cell>
              <br-tag
                shape="rounded"
                density="small"
                [label]="opcoesLabel(cat)"
                bgColor="gray-20">
              </br-tag>
            </br-table-cell>

            <br-table-cell>
              <div class="dias">
                <br-tag
                  *ngFor="let dia of diasAtivos(cat)"
                  shape="rounded"
                  density="small"
                  [label]="dia"
                  bgColor="green-vivid-20">
                </br-tag>
                <span *ngIf="diasAtivos(cat).length === 0" class="text-muted">Nenhum dia</span>
              </div>
            </br-table-cell>

            <br-table-cell>
              <div class="horario" *ngIf="cat.inicio && cat.fim">
                <i class="fas fa-clock mr-1 text-muted"></i>
                <span>{{ cat.inicio }} - {{ cat.fim }}</span>
              </div>
              <span *ngIf="!cat.inicio || !cat.fim" class="text-muted">Sempre</span>
            </br-table-cell>

            <br-table-cell>
              <br-tag
                shape="rounded"
                density="small"
                [label]="cat.ativo ? 'Ativa' : 'Inativa'"
                [bgColor]="statusColor(cat)">
              </br-tag>
            </br-table-cell>

            <br-table-cell horizontalAlign="center">
              <div class="actions">
                <br-button type="button" emphasis="tertiary" density="small" (click)="goToEdit(cat.id_categoria)">
                  <i class="fas fa-pen"></i>
                </br-button>
                <br-button type="button" emphasis="tertiary" density="small" (click)="confirmarExcluir(cat)">
                  <i class="fas fa-trash"></i>
                </br-button>
              </div>
            </br-table-cell>
          </br-table-row>
        </br-table>

        <div class="empty-state" *ngIf="paginatedCategorias().length === 0">
          <i class="fas fa-folder-open"></i>
          <p>Nenhuma categoria encontrada</p>
        </div>
      </div>

      <div class="pagination-container" *ngIf="!loading() && totalItems() > 0">
        <br-pagination
          [total]="totalPages()"
          [current]="currentPage()"
          [totalItems]="totalItems()"
          [perPage]="perPage()"
          [perPageOptions]="[5, 10, 25, 50]"
          variant="contextual"
          itemsText="categorias"
          perPageLabel="Itens por pagina"
          goToPageLabel="Ir para pagina"
          (pageChange)="onPageChange($event)"
          (perPageChange)="onPerPageChange($event)">
        </br-pagination>
      </div>
    </div>
  </br-card>
</div>
